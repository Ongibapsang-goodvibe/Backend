<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>음성 인식 완료</title>
<style>
  :root{--bg:#111;--panel:#1c1c1c;--btn:#2a2a2a;--accent:#ffb44c;--muted:#9aa0a6}
  body{margin:0;background:var(--bg);color:#eee;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;display:flex;justify-content:center}
  .phone{width:360px;min-height:640px;background:var(--panel);border-radius:20px;padding:18px;margin:24px;box-shadow:0 10px 30px rgba(0,0,0,.4)}
  h1{font-size:20px;margin:4px 0 16px}
  .bubble{background:#fff;color:#111;border-radius:14px;padding:14px;min-height:56px}
  .row{display:flex;gap:8px;margin-top:16px}
  .btn{flex:1;padding:14px 16px;border-radius:12px;border:1px solid #444;background:var(--btn);color:#eee;font-size:16px;cursor:pointer}
  .btn.primary{background:var(--accent);color:#000;border:0;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="phone">
  <h1>이렇게 말씀하셨나요?</h1>
  <div id="text" class="bubble"></div>
  <div class="row">
    <button id="no" class="btn">아니에요</button>
    <button id="yes" class="btn primary">맞아요</button>
  </div>
  <div class="small" id="status" style="margin-top:10px"></div>
</div>
<script>
  // CSRF
  function getCookie(name){const v=`; ${document.cookie}`.split(`; ${name}=`);if(v.length===2) return v.pop().split(';').shift();}
  const csrftoken=getCookie('csrftoken');

  const params = new URLSearchParams(location.search);
  const initial = params.get('initial_label') || '잘 먹었어요';
  const text = sessionStorage.getItem('mv_text') || '';
  document.getElementById('text').textContent = text || '(인식된 문장이 없습니다)';

  document.getElementById('no').onclick = ()=> history.back();

  document.getElementById('yes').onclick = async ()=>{
    if(!text){ alert('저장할 문장이 없어요. 다시 시도해 주세요.'); return; }
    const r = await fetch('/mealreview/logs/',{
      method:'POST',
      headers:{'Content-Type':'application/json','X-CSRFToken':csrftoken||''},
      credentials:'include',
      body:JSON.stringify({ initial_label: initial, text: text, source: 'VOICE' })
    });
    if(r.ok){ document.getElementById('status').textContent='저장 완료!'; setTimeout(()=>location.href='/mealreview/ui/overall/', 800); }
    else{ document.getElementById('status').textContent='저장 실패'; }
  };
</script>
</body>
</html>
