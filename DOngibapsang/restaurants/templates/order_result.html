{% load humanize %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>온기밥상 - 검색 결과</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;margin:24px}
    a{color:#0a66c2;text-decoration:none}
    h2{margin:0 0 12px}
    .row{display:flex;gap:8px;margin:8px 0 12px}
    input[type=text]{flex:1;padding:10px;font-size:16px}
    button{padding:10px 14px;font-size:16px;cursor:pointer}
    .muted{color:#666}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef;font-weight:700;margin-left:8px}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;margin-top:12px}
    .card{border:1px solid #ddd;border-radius:12px;padding:16px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.06)}
    .card .top{display:flex;gap:12px}
    .card img{width:96px;height:96px;object-fit:cover;border-radius:8px}
    .title{font-size:22px;font-weight:800}
    .meta{margin-top:10px;font-weight:600;color:#333;display:flex;gap:8px;flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="row"><a href="{% url 'restaurants:search-landing' %}">← 검색 페이지로 돌아가기</a></div>

  <h2>검색 결과 {% if stage %}<span class="pill">{{ stage }}</span>{% endif %}</h2>

  <!-- 재검색 폼 (GET) -->
  <form class="row" action="{% url 'restaurants:order-results' %}" method="get">
    <input name="q" type="text" value="{{ keyword }}" placeholder="예) 두부 / 순두부찌개 / 맛나식당" />
    <input type="hidden" name="limit" value="{{ limit|default:10 }}" />
    <button type="submit">검색</button>
  </form>

  {% if log %}
    <p class="muted">로그 #{{ log.id }} | keyword='{{ log.keyword }}' | stage={{ stage }}</p>
  {% endif %}

  <div class="cards">
    {% for c in cards %}
      <div class="card">
        <div class="top">
          {% if c.image_url %}<img src="{{ c.image_url }}" alt="{{ c.menu_name }}">{% endif %}
          <div>
            <div class="title">{{ c.menu_name }}</div>
            <div style="font-size:20px;font-weight:900">
              {% if c.price %}{{ c.price|intcomma }}원{% else %}-{% endif %}
            </div>
            <div class="muted">{{ c.restaurant_name }}</div>
          </div>
        </div>
        <div class="meta">
          <span>배달비 {% if c.delivery_fee %}{{ c.delivery_fee|intcomma }}원{% else %}-{% endif %}</span>
          <span>|</span>
          <span>{{ c.eta_text|default:"약 15~30분" }}</span>
        </div>
      </div>
    {% empty %}
      <p>결과가 없습니다.</p>
    {% endfor %}
  </div>
</body>
</html>
